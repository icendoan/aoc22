âŸ¨IntâŸ© â† â€¢Import "util.bqn"
lines â† â€¢file.Lines "7.input"
push  â† "$ cd"âŠ¸â‰¡Â¨ 4â†‘Â¨ lines
pop   â† "$ cd .."âŠ¸â‰¡Â¨ lines
depth â† +` push - 2 Ã— pop
files â† (('$' â‰  âŠ‘)Â¨ âˆ§ ("dir" â‰¢ 3 â†‘ âŠ¢)Â¨) lines
start â† sizes â† files Ã— (Int âŠ’âŸœ' ' â†‘ âŠ¢)Â¨ lines
subs  â† {("dir"â‰¡3â†‘âŠ¢) ğ•© ? 4 â†“ ğ•© ; ""}Â¨ lines
paths â† (<âŸ¨âŸ©) { s ğ•Š "$ cd ..": Â¯1 â†“ s ; s ğ•Š cmd: "$ cd" â‰¡ 4â†‘cmd? sâˆ¾â‹ˆ5â†“cmd;ğ•¨}` lines

{ ğ•Š d:
 mask â† depth = d
 leaves â† â· mask / paths
 pruned â† +Â´Â¨ paths âŠâŠ¸âŠ”â—‹(maskâŠ¸/) sizes
 sizes â†© sizes + (âŸ¨âŸ©âŠ¸â‰¢Â¨ subs) Ã— (leaves âŠ paths âˆ¾âŸœâ‹ˆÂ¨ subs) âŠ pruned âˆ¾ 0
} Â¨ âˆ¨â·depth

total â† +Â´Â¨ paths âŠâŠ¸âŠ” sizes
p1 â† +Â´ (100000 â‰¥ âŠ¢)âŠ¸/ total
p2 â† âŒŠÂ´ (3e7 â‰¤ total + 7e7 - +Â´ start) / total
p1â€¿p2
