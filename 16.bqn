âŸ¨Int, _splitâŸ© â† â€¢Import "util.bqn"

words â† ' 'âŠ¸= _splitÂ¨ â€¢file.Lines "16.input"
valves â† 1 âŠ‘Â¨ words
flows â† (Int âŠ¢ /Ëœ ('0'+â†•10) âˆŠËœ âŠ¢ )Â¨ 4 âŠ‘Â¨ words
outputs â† 2 â†‘Â¨Â¨ 9 â†“Â¨ words
adj â† > valves âˆŠâš‡2 outputs
MMul â† 1 âŒŠ âŠ£ +Ëâˆ˜Ã— â‰ 1â€¿âˆ âŠ¢
nzf â† / (0 < flows) âˆ¨ valves â‰¡Â¨ <"AA"
dist â† âŠ‘âˆ˜/â‰1 â‰> (<(1Â¨âŒ¾(0â€¿0â‰âŠ¢) â‰¢â¥Š0Ë™) adj) âˆ¾ MMulâŸ(â†•30)Ëœ 1Â¨âŒ¾(0â€¿0 â‰ âŠ¢) adj
start â† / (<"AA") â· nzf âŠ valves
graph â† (<nzf) âŠË˜ nzf âŠ dist
costs â† nzf âŠ flows
watermark â† Â¯âˆ
count â† 0

Walk â† { end Walk tâ€¿openâ€¿positionsâ€¿busy:
 { end â‰¤ t    ? +Â´ (open â‰  âˆ) / costs Ã— 0 âŒˆ end - open ;
   âˆ > âŒˆÂ´open ? +Â´ costs Ã— end - open ;
   moves â† Travel âŸ¨t, open, positions, busyâŸ©
   scores â† end WalkÂ¨ moves
   best â† âŒˆÂ´ scores
   { watermark < best ? watermark â†© best, â€¢Show âŸ¨watermark, countâŸ©; count 1âŠ¸+â†© }
   best
 }
}

Travel â† {ğ•Š âŸ¨t, open, positions, busyâŸ©:
 possible â† (open = âˆ) / <Ë˜â‰> (â†•âˆ˜â‰  â‹ˆ t + 1 + âŠ¢) (âŠ‘positions) âŠ graph
 (<positionsâ€¿busy) { positionsâ€¿busy ğ•Š newâ€¿delay:
  p â† New âŒ¾ âŠ‘ positions
  b â† delay âŒ¾ âŠ‘ busy
  grade â† â‹ b
  âŸ¨âŠ‘ grade âŠ b, delay âŒ¾ (new âŠ‘ âŠ¢) open, grade âŠ p, grade âŠ bâŸ©
 }Â¨ possible
}

#p1 â† 30 Walk âŸ¨0, 0âŒ¾(start âŠ‘ âŠ¢) âˆÂ¨nzf,   start,  â‹ˆ0âŸ©
#p2 â† 26 Walk âŸ¨0, 0âŒ¾(start âŠ‘ âŠ¢) âˆÂ¨nzf, 2â¥Šstart, 0â€¿0âŸ©
#p1â€¿p2
