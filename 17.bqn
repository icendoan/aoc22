num â† â‰  moves â† "<>" (-Ë=â‰0â€¿1) Â¯1 â†“ â€¢file.Chars "17.input"
rocks â† âŸ¨3,1,1,0,2âŸ© -âŠ¸âŒ½Â¨ Â¯2 âŒ½Ë˜Â¨ (<4â€¿7) â†‘Â¨ âŸ¨1â€¿4â¥Š1, 1Â¨âŒ¾(1âŠâŠ¢) 1Â¨âŒ¾(1âŠË˜âŠ¢) 3â€¿3 â¥Š 0, 1Â¨âŒ¾(2âŠâŠ¢) 1Â¨âŒ¾(2âŠË˜âŠ¢) 3â€¿3 â¥Š 0, 4â€¿1 â¥Š 1, 2â€¿2 â¥Š 1âŸ©

Shift â† { space ğ•Š âŸ¨move, rock, rowâŸ©:
 r â† move âŒ½Ë˜ rock
 {  âˆ¨Â´ (0 âŒŠ move) âŠË˜ rock ? rock ;
  r âˆ¨Â´âˆ˜â¥Šâˆ˜âˆ§ (Â¯4 â†‘ (1 + row) â†‘ space) ? rock ;
  r
 }
}

Step â† { Step âŸ¨space, rock, row, r, jet, hâŸ©:
 #Print âŸ¨space, rock, rowâŸ©
 rock â†© space Shift âŸ¨jet âŠ‘ moves, rock, rowâŸ©
 #Print âŸ¨space, rock, rowâŸ©
 { (Â¯4 â†‘ (2 + row) â†‘ space) âˆ¨Â´âˆ˜â¥Šâˆ˜âˆ§ rock ?
   Fix âŸ¨space, rock, row, 1 + r, num | 1 + jet, hâŸ© ;
   âŸ¨space, rock, row + 1, r, num | 1 + jet, hâŸ©
 }
}

Fix â† { ğ•Š âŸ¨space, rock, row, r, j, hâŸ©:
 space â†© (rock âˆ¨ âŠ¢) âŒ¾ (Â¯4 â†‘ âŠ¢) âŒ¾ ((4 + 1 + row) â†‘ âŠ¢) (4â€¿7 â¥Š 0) âˆ¾ space
 space â†© (4 -Ëœ âŠ‘ / âˆ¨Â´Ë˜ space) â†“ space
 spaceâ€¿h â†© { 1000 < â‰ space ? âŸ¨Â¯100 â†“ space, h + 100âŸ© ; spaceâ€¿h }
 âŸ¨space, (5|r) âŠ‘ rocks, 0, r, j, hâŸ©
}

Print â† { ğ•Š âŸ¨space, rock, rowâŸ©:
 â€¢Show ".#@" âŠËœ ((2Ã—rock) + âŠ¢) âŒ¾ (Â¯4 â†‘ âŠ¢) âŒ¾ ((4 + 1 + row) â†‘ âŠ¢) (4â€¿7 â¥Š 0) âˆ¾ space
}

p1 â† {(5 âŠ‘ ğ•©) + Â¯5 + â‰ âŠ‘ğ•©} Step â€¢_while_ (2022 > 3 âŠ‘ âŠ¢) âŸ¨(4â€¿7 â¥Š 0) âˆ¾ 1â€¿7 â¥Š 1, âŠ‘rocks, 0, 0, 0, 0âŸ©
cycle â† 5 Ã— num
stages â† Step âŸ (cycle Ã— 1 + â†•8) âŸ¨(4â€¿7 â¥Š 0) âˆ¾ 1â€¿7 â¥Š 1, âŠ‘rocks, 0, 0, 0, 0âŸ©
blocks â† -âŸœÂ»Ëœ 3 âŠ‘Â¨ stages
grown â† -âŸœÂ»Ëœ {Â¯5 + (â‰ âŠ‘ğ•©) + 5 âŠ‘ ğ•©}Â¨ stages
pblocks â† +Â´Â¨ (/5â€¿3) âŠ” 8 â†‘ blocks
pgrown â† +Â´Â¨ (/5â€¿3) âŠ” 8 â†‘ grown
dropped â† 1000000000000
base â† (âŠ‘pgrown) + (1âŠ‘pgrown) Ã— âŒŠ (1âŠ‘pblocks) Ã·Ëœ dropped - (âŠ‘pblocks)
rem â† (1âŠ‘pblocks) | dropped - (âŠ‘pblocks)
p2 â† {
 âŸ¨space, rock, row, r, j, hâŸ© â† âŠ‘stages
 {(5âŠ‘ğ•©) + Â¯5 + â‰ âŠ‘ğ•©} Step â€¢_while_ { ğ•ŠâŸ¨space, rock, row, r, j, hâŸ©: r â‰¤ dropped } âŸ¨space, rock, row, dropped - rem, 0, 4 + base - â‰ spaceâŸ©
}
p1â€¿p2
