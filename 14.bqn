âŸ¨Int, _splitâŸ© â† â€¢Import "util.bqn"
corners â† Intâš‡Â¯3 (','=âŠ¢) _splitâš‡Â¯2 ("->"â‰¢âŠ¢)Â¨âŠ¸/Â¨ (' '=âŠ¢) _splitÂ¨ â€¢file.Lines "14.input"
lines â† (âŠâˆ¾1â†“âŠ¢-Â¯1âŒ½âŠ¢)Â¨ corners
origin â† âŸ¨âˆ, 0âŸ© âŒŠÂ´ âˆ¾ corners
space â† origin +âš‡1 Â¯1 + (â†• 3 + âŒˆÂ´ - Origin) âˆ¾ corners
start â† 500â€¿0 - âŠ‘space
Draw â† {wğ•Šx: {2=â‰¡w?Â¯1âŠw;w} +âš‡1 (<Ã—x) Ã— â†•1+âŒˆÂ´|x }
points â† â·âˆ¾ {(<âŠ‘ğ•©)âˆ¾âˆ¾1â†“ğ•©}Â¨ draw`Â¨ lines
stone â† grid â† space âˆŠ points
Shift â† {
 ğ•¨ğ•Š1â€¿1: grid 1âŒ¾(ğ•¨ âŠ‘ âŠ¢) â†©, âˆâ€¿âˆ;
 ğ•¨ğ•Š0â€¿n: ğ•¨ + Â¯1â€¿1;
 ğ•¨ğ•Š1â€¿0: ğ•¨ + 1â€¿1;
 ğ•¨ğ•Šğ•©: !Ëœ "Unhandled case"â€¿ğ•©
}

Cast â† {ğ•Šxâ€¿y:
 stops â† (y<âŠ¢)âŠ¸/ / x âŠâŠâŸ¨âŸ© grid, { 1â‰¤â‰ stops ? c â† âŠ‘stops, âŸ¨x, c-1âŸ© Shift âŸ¨âŸ¨x-1, câŸ©, âŸ¨x+1, câŸ©âŸ© âŠ‘ grid ; Â¯âˆâ€¿Â¯âˆ }
} â€¢_while_ ((âˆâ€¿âˆ â‰¢ |))
{ğ•Šğ•©: Cast â€¢_while_ (âˆâ€¿âˆ â‰¢ |) start} â€¢_while_ (âˆâ€¿âˆ â‰¡ âŠ¢) âˆâ€¿âˆ
p1 â† +Â´ â¥Š stone -Ëœ grid

# increase the size of the grids
stone (âˆ¾âŸœ1Ë˜ (â‰¢â¥Š0Ë™)âŠ¸(âŠ£âˆ¾âŠ¢âˆ¾âŠ£)âŸ2) â†©
grid  (âˆ¾âŸœ1Ë˜ (â‰¢â¥Š0Ë™)âŠ¸(âŠ£âˆ¾âŠ¢âˆ¾âŠ£)âŸ2) â†©
start ((4Ã—â‰ space)â€¿0 + âŠ¢) â†©

{ğ•Šğ•©: Cast start} â€¢_while_ {ğ•Šğ•©: 0 = start âŠ‘ grid} @
p2 â† +Â´ â¥Š stone -Ëœ grid
